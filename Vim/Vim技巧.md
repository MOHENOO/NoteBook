# Vim 技巧

## Vim解决问题的方式

### 技巧1 .命令

> .命令可以重复上次的修改。

### 技巧2 不要自我重复

>使用复合命令，减少无关的移动，避免长命令。

| 复合命令 | 等效的长命令 |
| :------: | :----------: |
|    C     |      c$      |
|    s     |      cl      |
|    S     |      ^C      |
|    I     |      ^i      |
|    A     |      $a      |
|    o     |      A       |
|    O     |      ko      |

### 技巧3 以退为进

>以退为进，从而使命令可重复。

### 技巧4 执行，重复，回退

>在面对重复性工作时，我们需要让移动动作和修改都能够重复。

|           目的           |         操作          | 重复  | 回退  |
| :----------------------: | :-------------------: | :---: | :---: |
|       做出一个修改       |        {edit}         |   .   |   u   |
| 在行内查找下一指定字符  |    f{char}/t{char}    |   ;   |   ,   |
|  在行内查找上一指定字符  |    F{char}/T{char}    |   ;   |   ,   |
| 在文档中查找下一处匹配项 |       /pattern        |   n   |   N   |
| 在文档中查找上一处匹配项 |       ?pattern        |   n   |   N   |
|         执行替换         | :s/target/replacement |   &   |   u   |
|      执行一系列修改      |     qx{changes}q      |  @x   |   u   |

### 技巧5 查找并手动替换

>/{word} 查找

### 技巧6 认识.范式

>用一键移动，另一键执行。

## 普通模式

### 技巧7 停顿时移开画笔

>思考时返回普通模式

### 技巧8 把撤销单元切成块

>在Vim中，我们可以控制撤销的粒度。从进入插入模式开始，直到返回普通模式为止，在此期间输入或删除的任何内容都被当作一次修改。因此，只要控制好对\<ESC>键的使用，就可以使撤销命令作用于单词，句子或段落。
如果在插入模式中使用了\<Up>,\<Down>,\<Left>,\<Right>这些光标键，将会产生一个新的撤销块。这会对.命令产生影响。

技巧9 构造可重复的修改

>在Vim中，要完成一件事，总有不止一种方式。尽量选择可以一次撤销对方式

### 技巧10 用次数做简单的算术运算

>大多数普通模式命令可以在执行时指定次数，可以利用这个功能来做简单的算术运算

\<C-a>和\<C-x>命令分别对数字执行加和减操作。如果带一个次数前缀，就可以用它们加减任意整数。

>如果光标不在数字上，命令会作用于当前光标之后的数值。即进行一次正向搜索。

### 技巧11 能够重复，就别用次数

>使用重复，修改的粒度更小，更为可控。对一些简单的操作，可以使用次数。

### 技巧12 双剑合璧

>Vim的强大很大程度上源自操作符于动作命令相结合。
操作符+动作命令=操作
d{motion}命令可以对一个字符(dl),一个完整单词(daw)或一整个段落(dap)进行操作，它作用的范围由动作命令决定。
g~大小写切换,gu全小写,gU全大写。
>Vim的语法只有一条额外规则，即当一个操作符命令被连续调用两次时，它会作用于当前行。

| 命令  |     用途     |
| :---: | :----------: |
|   c   |     修改     |
|   d   |     删除     |
|   y   | 复制到寄存器 |
|  g~   |  反转大小写  |
|  gu   |  转换为小写  |
|  gU   |  转换为大写  |
|  ">"  |   增加缩进   |
|  \<   |   减小缩进   |
|   =   |   自动缩进   |

## 插入模式

### 技巧13 在插入模式中可即时更正错误

| 按键操作 |            用途            |
| :------: | :------------------------: |
|   C-h    | 删除前一个字符（同退格键） |
|   C-w    |       删除前一个单词       |
|   C-u    |         删至行首          |

### 技巧14 返回普通模式

| 按键操作 |        用途         |
| :------: | :-----------------: |
|   Esc    |    切换普通模式     |
|   C-[    |    切换普通模式     |
|   C-o    | 切换到插入-普通模式 |

### 技巧15 不离开插入模式，粘贴寄存器中的文本

>yt,命令把文本复制到专用寄存器中。然后在插入模式中，按\<C-r>0把刚才复制的文本粘贴到光标所在位置。
\<C-r>{register},其中{register}是想要插入的寄存器的名字。但如果寄存器中包含大量文本，可能会导致屏幕延时。这是因为Vim在插入寄存器内的文本时，其插入方式就如同一个一个输入。因此如果有"textwidth"或者"autoindent"选项的话,就会导致不必要的换行或缩进。\<C-r>\<C-p>{register}命令会智能一些，它会按原义插入文本。如果粘贴很多行文本的话，还是切换到普通模式。

### 技巧16 随时随地做运算

>表达式寄存器允许我们做一些运算，并把运算结果直接插入文档中。插入模式中\<C-r>={表达式}

### 技巧17 用字符编码插入非常用字符

>Vim可以用字符编码插入任意字符。插入模式中输入\<C-v>{code}。如果插入编码超过3位的字符，需要用16进制编码（\<C-v>u{code}。）

### 技巧18 用二合字母插入非常用字符

>在插入模式中，输入\<C-k>{char1}{char2}。用命令:digraphs可以查看二合字母列表。或者:h digraph-table

### 技巧19 用替换模式替换已有文本

>R命令可以由普通模式进入替换模式。也可以用insert键触发。Vim还有另外一种替换模式，称为虚拟替换模式。由gR触发，他会把制表符当作一组空格处理。可以解决制表符显示长度和输入长度不一致的问题。因此尽量使用虚拟替换模式。

## 可视模式

>Vim的可视模式允许选中一块文本区域并在其上进行操作。Vim有3种不同的可视模式，分别用于操作字符文本，行文本，块文本。也可以用.命令重复执行可视模式中的命令，然而，只要在操作面向行的选区时，它才特别有用。

### 技巧20 深入理解可视模式

>可视模式中需要先选中选区，然后再触发修改命令。

### 技巧21 选择高亮选区

>在普通模式下，按v可激活面向字符的可视模式，按V可激活面向行的可视模式，而按\<C-v>则可激活面向列块的可视模式。gv命令可以重选上次的高亮选区。但如果选区被删除了，它也许会工作得不太正常。可视模式之间可以相互切换。
o可以切换高亮选区的活动端。高亮选区的范围由其两个端点界定。其中一端固定，另一端可以随光标自由移动，可以用o键来切换其活动的端点。

### 技巧22 重复执行面向行的可视命令

>.命令重复一条可视模式命令时，它操作的文本数量和上次被高亮选中的文本数量相同。

### 技巧23 只要可能，最好用操作符命令，而不是可视命令。

>可视命令修改文本时，.命令的作用范围等同于上次命令的作用范围，有时其表现可能不如人意。

### 技巧24 用面向列块的可视模式编辑表格数据

>使用C-v对多列进行编辑

### 技巧25 修改列文本

>使用C-v对多列进行编辑

### 技巧26 在长短不一的高亮块后添加文本

>使用$实现长短不一的高亮块。

## 命令行模式

### 技巧27 认识Vim的命令行模式

>在按下:键时，Vim会切换到命令行模式。这时可以输入一条命令，然后按\<CR>执行它。在任何时候都可以按\<Esc>键从命令行模式切换会普通模式。

|                     命令                      |                       用途                       |
| :-------------------------------------------: | :----------------------------------------------: |
|               :[range]delete[x]               |         删除指定范围内的行[到寄存器x中]          |
|                :[range]yank[x]                |          复制指定范围的行[到寄存器x中]           |
|                 :[line]put[x]                 |          在指定行后粘贴寄存器x中的内容           |
|             :[range]copy{address}             |    把指定范围的行拷贝到{address}指定的行之下     |
|             :[range]move{address}             |    把指定范围的行移动到{address}指定的行之下     |
|                 :[range]join                  |                连接指定范围内的行                |
|           :[range]normal{commands}            |  对指定范围内的每一行执行普通模式命令{commands}  |
| :[range]substitute/{pattern}/{string}/[flags] |  把指定范围内出现{pattern}的地方替换为{string}   |
|        :[range]global/{pattern}/[cmd]         | 对指定范围内匹配{pattern}的所有行执行Ex命令{cmd} |

>Ex命令操作范围更大，并且能够在一次执行中修改多行。

### 技巧28 在一行或多个连续行上执行命令

>Ex命令的优点之一是它可以在某一范围内的所有行上执行。

| 符号  |             地址             |
| :---: | :--------------------------: |
|   1   |         文件的第一行         |
|   $   |        文件的最后一行        |
|   0   | 虚拟行，位于文件的第一行上方 |
|   .   |          光标所在行          |
|  'm   |      包含位置标记m的行       |
|  '\<  |       高亮选区的起始行       |
|  '>   |       高亮选区的结束行       |
|   %   |   整个文件(:1,$的简写形式)   |

### 技巧29 使用':t'和':m'命令复制和移动行

>:copy命令的简写形式:t,:move命令的简写形式:m

### 技巧30 在指定范围上执行普通模式命令

>:normal 可以在指定范围上执行普通模式命令。

### 技巧31 重复上次的Ex命令

>@:可以重复上次的命令

### 技巧32 自动补全Ex命令

>Tab会自动补全命令，\<C-d>命令会让Vim显示可用的补全列表。

### 技巧33 把当前单词插入命令行

>在Vim的命令行下，\<C-r>\<C-w>映射项会复制光标下的单词并把它插入命令行中。

### 技巧34 回溯历史命令

>Vim会记录命令行模式下的命令历史，并且可以很容易地回溯之前的命令。

### 技巧35 运行Shell命令

>在Vim的命令行模式中，给命令加一个!就可以调用外部程序。shell命令可以使Vim置于后台。

|        命令         |                      用途                      |
| :-----------------: | :--------------------------------------------: |
|       :shell        |        启动一个shell（输入exit返回Vim）        |
|       :!{cmd}       |               在shell中执行{cmd}               |
|     :read!{cmd}     | 在shell中执行{cmd}，并把其标准输出插入光标下方 |
| :[range]write!{cmd} |  在shell中执行{cmd}，以[range]作为其标准输入   |
|  :[range]!{filter}  |     使用外部程序{filter}过滤指定的[range]      |

### 技巧36 批处理运行Ex命令

>如果要执行一连串Ex命令，可以把它们置于脚本之中，从而节省工作量。