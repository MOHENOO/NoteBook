# 联结表

## 联结

SQL最强大的功能之一就是能在数据查询的执行中联结表(join).联结是利用SQL的SELECT能执行的最重要的操作.

### 关系表

关系表的设计就是把信息分解成多个表,一类数据一个表.各表通过某些共同的值互相关联.这样做的好处是:信息不重复,不会浪费时间和空间;如果某一信息改变可以只更新单个表,相关表中的数据不用改动;由于数据不重复,数据显然是一致的,使得处理数据和生成报表更简单.

### 为什么使用联结

如果数据存储在多个表,SELECT语句需要使用联结.联结是一种机制,用来在一条SELECT语句中关联表.使用特殊的语法,可以联结多个表返回一组输出,联结在运行时关联表中正确的行.

**使用交互式DBMS工具**:重要的是,理解联结不是物理实体.换句话说,它在实际的数据库表中并不存在.DBMS会根据需要建立联结,它在查询执行期间一直存在.

## 创建联结

```sql
SELECT vend_name,prod_name,prod_price
FROM Vendors,Products
WHERE Vendors.vend_id=Products.vend_id;
```

WHERE子句指示DBMS将表通过vend_id匹配起来.在引用的列可能出现歧义时,必须使用完全限定列名(用一个句点分隔表名和列名).

### WHERE子句的重要性

使用WHERE子句建立联结关系时,因为在一条SELECT语句中联结几个表时,相应的关系是在运行中构造.在数据库表定义中没有指示DBMS如何对表进行联结的内容.你必须自己做这件事情.在联结两个表时,实际要做的是将第一个表中的每一行与第二个表中的每一行配对.WHERE子句作为过滤条件,只包含那些匹配给定条件的(这里时联结条件)的行.

**笛卡尔积**:由没有联结条件的表关系返回的结果为笛卡尔积.检索出的行的数目将是两个表行数的乘积.

```sql
SELECT vend_name,prod_name,prod_price
FROM Vendors,Products;
```

**不要忘了WHERE子句**:要保证所有联结都有WHERE子句,否则DBMS将返回比想要的数据多得多的数据.同理,要保证WHERE子句的正确性.不正确的过滤条件会导致DBMS返回不正确的数据.

### 内联结

目前为止使用的联结称为等值联结,它基于两个表之间的相等测试.这种联结也称为内连接.其实可以对这种联结使用稍微不同的语法,明确指定联结的类型.

```sql
SELECT vend_name,prod_name,prod_price
FROM Vendors INNER JOIN Products
ON Vendors.vend_id=Products.vend_id;
```

**“正确的”语法**:ANSI SQL规范首选INNER JOIN语法,之前使用的是简单的等值语法.DBMS一般两种都支持.

### 联结多个表

**性能考虑**:DBMS在运行时关联指定的每个表,以处理联结.这种处理可能非常耗费资源,因此应该注意,不要联结不必要的表.联结的表越多,性能下降越厉害.

**联结表中的最大数目**:虽然SQL本身不限制每个联结约束中表的数目,但实际上许多DBMS都有限制.