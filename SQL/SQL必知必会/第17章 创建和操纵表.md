# 创建和操纵表

## 创建表

SQL不仅用于表数据操纵,还用来执行数据库和表的所有操作,包括表的创建和处理.

一般有两种创建表的方法:

- 多数DBMS都具有交互式创建和管理数据库表的工具;
- 表也可以直接用SQL语句操纵.

用程序创建表,可以使用SQL的CREATE TABLE语句.需要注意的是,使用交互式工具时实际上就是使用SQL语句.这些语句不是用户编写的,界面工具会自动生成并执行相应的SQL语句(更改已有的表时也是这样的).

### 表创建基础

利用CREATE TABLE创建表,必须给出下列信息:

- 新表的名字,在关键字CREATE TABLE之后给出;
- 表列的名字和定义,用逗号分隔;
- 有的DBMS还要求指定表的位置.

```sql
CREATE TABLE Products
(
    prod_id CHAR(10) NOT NULL,
    vend_id CHAR(10) NOT NULL
);
```

**替换现有的表**:在创建新的表时,指定的表名必须不存在,否则会出错.防止意外覆盖已有的表,SQL要求首先手动删除该表,然后在重建它,而不是简单地用创建表语句覆盖它.

### 使用NULL值

在不指定NOT NULL时,多数DBMS认为指定的NULL,但不是所有的DBMS都这样.

### 指定默认值

SQL允许指定默认值,在插入行时如果不给出值,DBMS将自动采用默认值.默认值在CREATE TABLE语句的列定义中用关键字DEFAULT指定.

## 更新表

更新表定义,可以使用ALTER TABLE语句.虽然所有的DBMS都支持ALTER TABLE,但它们所允许更新的内容差别很大.

- 理想情况,不要在表中包含数据时对其进行更新.应该在表设计过程中充分考虑未来可能的需求,避免今后对表结构做大改动.
- 所有的DBMS都允许给现有的表增加列,不过对所增加列的数据类型(以及NULL和DEFAULT的使用)有所限制.
- 许多DBMS不允许删除或更改表中的列
- 多数DBMS允许重新命名表中的列
- 许多DBMS限制对已经填有数据的列进行更改,对未填有数据的列几乎没有限制.

```sql
ALTER TABLE Vendors
ADD vend_phone CHAR(20);
```

```sql
ALTER TABLE Vendors
DROP COLUMN vend_phone;
```

复杂的表结构更改一般需要手动删除过程,它涉及以下步骤:

1. 用新的列布局创建一个新表;
2. 使用INSERT SELECT语句从旧表复制数据到新表.
3. 检验包含所需数据的新表;
4. 重命名旧表(如果确定,可以删除它)
5. 用旧表原来的名字重命名新表;
6. 根据需要,重新创建触发器,存储过程,索引和外键.

**ALTER TABLE和SQLite**:SQLite对使用ALTER TABLE执行的操作有所限制.最重要的一个限制是,它不支持使用ALTER TABLE定义主键和外键,这些必须在最初创建表时指定.

**小心使用ALTER TABLE**:使用ALTER TABLE要极为小心,应该在进行改动前做完整的备份(模式和数据的备份).数据库表的更改不能撤销,如果增加了不需要的列,也许无法删除它们.类似的,如果删除了不应该删除的列,可能会丢失该列中的所有数据.

## 删除表

删除表(删除整个表而不是其内容)非常简单,使用DROP TABLE语句即可.

```sql
DROP TABLE CustCopy;
```

删除表没有确认,也不能撤销,执行这条语句将永久删除该表.

**使用关系规则防止意外删除**:许多DBMS允许强制实施有关规则,防止删除与其他表相关联的表.在实施这些规则时,如果对某个表发布一条DROP TABLE,且改表是某个关系的组成部分,则DBMS将阻止这条语句执行,直到该关系被删除为止.如果允许,应该启用这些选项,它能防止意外删除有用的表.

## 重命名表

每个DBMS对表重命名的支持有所不同.对于这个操作,不存在严格的标准.DB2,MariaDB,MySQL,Oracle和PostgreSQL用户使用RENAME语句,SQL Server使用sp_rename存储过程,SQLite使用ALTER TABLE语句.